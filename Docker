# ================================================================
# NetRecommender-Capstone â€” L6 Production Dockerfile
# GPU-enabled TensorFlow + Python environment
# Author: Corey Leath (Trojan3877)
# ================================================================

# ------------------------------------------------
# BASE IMAGE (NVIDIA GPU-Optimized TensorFlow)
# ------------------------------------------------
FROM tensorflow/tensorflow:latest-gpu

# ------------------------------------------------
# System Dependencies
# ------------------------------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    build-essential \
    python3-dev \
    libgl1 \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------
# Set Working Directory
# ------------------------------------------------
WORKDIR /app

# ------------------------------------------------
# Copy Requirements First (Layer Caching)
# ------------------------------------------------
COPY requirements.txt .

# ------------------------------------------------
# Install Python dependencies
# ------------------------------------------------
RUN pip install --upgrade pip && pip install -r requirements.txt

# ------------------------------------------------
# Copy Application Code
# ------------------------------------------------
COPY . .

# ------------------------------------------------
# Create Non-Root User for Security
# ------------------------------------------------
RUN useradd -m appuser
USER appuser

# ------------------------------------------------
# Expose Ports (for API or model server later)
# ------------------------------------------------
EXPOSE 8080

# ------------------------------------------------
# Default Command (train or inference)
# ------------------------------------------------
CMD ["python", "src/train.py"]
